<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SignaliStrasti - Balkanska studija neverbalne privlačnosti</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* ============================================
       CSS VARIABLES - Design System Tokens
       ============================================ */
    :root {
      /* Brand Colors */
      --ss-espresso: #1A1412;
      --ss-cherry: #C24858;
      --ss-blush: #E9C9C3;
      --ss-ivory: #F6F1EC;
      --ss-taupe: #C8B8A6;
      --ss-gold: #D2A95B;
      
      /* Semantic Colors */
      --ss-color-primary: var(--ss-espresso);
      --ss-color-secondary: var(--ss-cherry);
      --ss-color-accent: var(--ss-blush);
      --ss-color-bg: var(--ss-ivory);
      --ss-color-text: var(--ss-espresso);
      --ss-color-text-light: #6d6259;
      --ss-color-border: var(--ss-taupe);
      --ss-color-white: #ffffff;
      --ss-color-success: #10b981;
      --ss-color-error: #ef4444;
      
      /* Spacing Scale */
      --ss-spacing-xs: 0.5rem;
      --ss-spacing-sm: 0.75rem;
      --ss-spacing-md: 1rem;
      --ss-spacing-lg: 1.5rem;
      --ss-spacing-xl: 2rem;
      --ss-spacing-2xl: 3rem;
      --ss-spacing-3xl: 4rem;
      --ss-spacing-4xl: 6rem;
      
      /* Typography */
      --ss-font-heading: 'Playfair Display', serif;
      --ss-font-body: 'Inter', system-ui, sans-serif;
      
      /* Border Radius */
      --ss-radius-sm: 0.5rem;
      --ss-radius-md: 1rem;
      --ss-radius-lg: 1.25rem;
      --ss-radius-xl: 1.5rem;
      --ss-radius-2xl: 2rem;
      --ss-radius-full: 999px;
      
      /* Shadows */
      --ss-shadow-sm: 0 10px 25px rgba(26, 20, 18, 0.08);
      --ss-shadow-md: 0 20px 40px rgba(26, 20, 18, 0.12);
      --ss-shadow-lg: 0 30px 60px rgba(26, 20, 18, 0.16);
      --ss-shadow-card: var(--ss-shadow-sm);
      --ss-shadow-modal: var(--ss-shadow-lg);
      
      /* Transitions */
      --ss-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* ============================================
       RESET & BASE
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: var(--ss-font-body);
      color: var(--ss-color-text);
      line-height: 1.6;
      background-color: var(--ss-color-bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* ============================================
       TYPOGRAPHY
       ============================================ */
    h1, h2, h3, h4, h5, h6 {
      font-family: var(--ss-font-heading);
      font-weight: 700;
      line-height: 1.2;
      color: var(--ss-color-primary);
      margin-bottom: var(--ss-spacing-md);
    }
    
    h1 {
      font-size: clamp(1.875rem, 4vw, 2.75rem);
      line-height: 1.18;
      margin-bottom: var(--ss-spacing-lg);
    }
    
    h2 {
      font-size: clamp(1.5rem, 3vw, 2.25rem);
      margin-bottom: var(--ss-spacing-lg);
    }
    
    h3 {
      font-size: clamp(1.25rem, 2.5vw, 1.75rem);
    }
    
    p {
      margin-bottom: var(--ss-spacing-md);
      line-height: 1.7;
    }
    
    a {
      color: var(--ss-color-secondary);
      text-decoration: none;
      transition: var(--ss-transition);
    }
    
    a:hover {
      opacity: 0.8;
    }
    
    em {
      font-style: italic;
    }
    
    strong {
      font-weight: 600;
    }
    
    /* ============================================
       LAYOUT
       ============================================ */
    .ss-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 var(--ss-spacing-md);
    }
    
    @media (min-width: 768px) {
      .ss-container {
        padding: 0 var(--ss-spacing-xl);
      }
    }
    
    .ss-section {
      padding: var(--ss-spacing-2xl) 0;
    }
    
    @media (min-width: 768px) {
      .ss-section {
        padding: var(--ss-spacing-3xl) 0;
      }
    }
    
    .ss-section-bg-white {
      background-color: var(--ss-color-white);
    }
    
    .ss-section-bg-ivory {
      background-color: var(--ss-color-bg);
    }
    
    .ss-text-center {
      text-align: center;
    }
    
    /* ============================================
       HEADER / HERO SECTION
       ============================================ */
    .ss-header {
      padding-top: var(--ss-spacing-xl);
      margin-bottom: var(--ss-spacing-2xl);
    }
    
    .ss-category-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.45rem 0.85rem;
      border-radius: var(--ss-radius-full);
      background: var(--ss-color-accent);
      color: var(--ss-color-secondary);
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: var(--ss-spacing-md);
    }
    
    .ss-byline {
      font-size: 0.95rem;
      color: var(--ss-color-text-light);
      margin-bottom: var(--ss-spacing-sm);
    }
    
    .ss-lead-quote {
      font-size: 1.05rem;
      color: var(--ss-color-text);
      border-left: 3px solid var(--ss-color-border);
      padding-left: var(--ss-spacing-md);
      margin: var(--ss-spacing-md) 0 var(--ss-spacing-lg);
      font-style: italic;
    }
    
    .ss-headline .u {
      text-decoration: none;
      border-bottom: 1px solid currentColor;
      padding-bottom: 1px;
    }
    
    /* ============================================
       VIDEO / VSL SECTION
       ============================================ */
    .ss-video-wrapper {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 16:9 */
      background: #000;
      border-radius: var(--ss-radius-xl);
      overflow: hidden;
      box-shadow: var(--ss-shadow-lg);
      margin-bottom: var(--ss-spacing-xl);
    }
    
    .ss-video-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .ss-video-gate {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    .ss-video-gate.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }
    
    .ss-video-thumbnail {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.6;
    }
    
    .ss-play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.95);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--ss-transition);
      box-shadow: var(--ss-shadow-lg);
      z-index: 11;
    }
    
    .ss-play-button:hover {
      transform: translate(-50%, -50%) scale(1.1);
      background: var(--ss-color-white);
    }
    
    .ss-play-button svg {
      width: 32px;
      height: 32px;
      margin-left: 4px;
      fill: var(--ss-color-primary);
    }
    
    .ss-play-text {
      position: absolute;
      bottom: var(--ss-spacing-xl);
      left: 50%;
      transform: translateX(-50%);
      color: var(--ss-color-white);
      font-size: 1.1rem;
      font-weight: 600;
      text-align: center;
      z-index: 11;
    }
    
    @media (min-width: 768px) {
      .ss-play-button {
        width: 100px;
        height: 100px;
      }
      
      .ss-play-button svg {
        width: 40px;
        height: 40px;
      }
    }
    
    /* ============================================
       MODAL
       ============================================ */
    .ss-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--ss-transition);
      padding: var(--ss-spacing-md);
    }
    
    .ss-modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .ss-modal {
      background: var(--ss-color-white);
      border-radius: var(--ss-radius-lg);
      padding: var(--ss-spacing-xl);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--ss-shadow-modal);
      transform: scale(0.9) translateY(20px);
      transition: var(--ss-transition);
      position: relative;
    }
    
    .ss-modal-overlay.active .ss-modal {
      transform: scale(1) translateY(0);
    }
    
    .ss-modal-close {
      position: absolute;
      top: var(--ss-spacing-md);
      right: var(--ss-spacing-md);
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--ss-radius-sm);
      transition: var(--ss-transition);
    }
    
    .ss-modal-close:hover {
      background: #f3f4f6;
    }
    
    .ss-modal-close svg {
      width: 20px;
      height: 20px;
      fill: var(--ss-color-text);
    }
    
    .ss-modal-title {
      font-size: 1.5rem;
      margin-bottom: var(--ss-spacing-sm);
      padding-right: var(--ss-spacing-xl);
    }
    
    .ss-modal-subtitle {
      color: var(--ss-color-text-light);
      margin-bottom: var(--ss-spacing-xl);
      font-size: 0.95rem;
    }
    
    /* ============================================
       FORMS
       ============================================ */
    .ss-form-group {
      margin-bottom: var(--ss-spacing-lg);
    }
    
    .ss-form-label {
      display: block;
      font-weight: 600;
      margin-bottom: var(--ss-spacing-xs);
      color: var(--ss-color-primary);
      font-size: 0.9rem;
    }
    
    .ss-form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--ss-color-border);
      border-radius: var(--ss-radius-md);
      font-family: inherit;
      font-size: 1rem;
      transition: var(--ss-transition);
      background: var(--ss-color-white);
    }
    
    .ss-form-input:focus {
      outline: none;
      border-color: var(--ss-color-secondary);
      box-shadow: 0 0 0 3px rgba(194, 72, 88, 0.1);
    }
    
    .ss-form-input.error {
      border-color: var(--ss-color-error);
    }
    
    .ss-form-error {
      color: var(--ss-color-error);
      font-size: 0.85rem;
      margin-top: var(--ss-spacing-xs);
      display: none;
    }
    
    .ss-form-error.show {
      display: block;
    }
    
    .ss-form-button {
      width: 100%;
      padding: 1rem;
      background: var(--ss-color-primary);
      color: var(--ss-color-white);
      border: none;
      border-radius: var(--ss-radius-md);
      font-family: inherit;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--ss-transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ss-spacing-xs);
    }
    
    .ss-form-button:hover:not(:disabled) {
      background: var(--ss-color-secondary);
      transform: translateY(-2px);
      box-shadow: var(--ss-shadow-md);
    }
    
    .ss-form-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    /* ============================================
       BUTTONS / CTAs
       ============================================ */
    .ss-cta-button {
      display: inline-block;
      padding: 1.25rem 2.5rem;
      background: var(--ss-color-secondary);
      color: var(--ss-color-white);
      border-radius: var(--ss-radius-lg);
      font-weight: 700;
      font-size: 1.1rem;
      text-align: center;
      transition: var(--ss-transition);
      box-shadow: var(--ss-shadow-md);
      border: none;
      cursor: pointer;
      text-decoration: none;
    }
    
    .ss-cta-button:hover {
      transform: translateY(-3px);
      box-shadow: var(--ss-shadow-lg);
      opacity: 0.95;
    }
    
    .ss-cta-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .ss-cta-section {
      background: linear-gradient(135deg, var(--ss-color-primary) 0%, var(--ss-color-secondary) 100%);
      color: var(--ss-color-white);
      padding: var(--ss-spacing-3xl) var(--ss-spacing-md);
      border-radius: var(--ss-radius-lg);
      text-align: center;
      margin: var(--ss-spacing-3xl) 0;
    }
    
    .ss-cta-section h2 {
      color: var(--ss-color-white);
      margin-bottom: var(--ss-spacing-md);
    }
    
    .ss-cta-section p {
      font-size: 1.1rem;
      margin-bottom: var(--ss-spacing-xl);
      opacity: 0.95;
    }
    
    /* ============================================
       IMAGES
       ============================================ */
    .ss-image {
      width: 100%;
      height: auto;
      display: block;
      border-radius: var(--ss-radius-xl);
    }
    
    .ss-image-rounded {
      border-radius: var(--ss-radius-xl);
    }
    
    /* ============================================
       TESTIMONIALS GRID
       ============================================ */
    .ss-testimonials-grid {
      display: grid;
      gap: var(--ss-spacing-lg);
      margin: var(--ss-spacing-xl) 0;
    }
    
    @media (min-width: 768px) {
      .ss-testimonials-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (min-width: 1024px) {
      .ss-testimonials-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    .ss-testimonial-item {
      border-radius: var(--ss-radius-lg);
      overflow: hidden;
      box-shadow: var(--ss-shadow-sm);
    }
    
    .ss-testimonial-item img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* ============================================
       UTILITY CLASSES
       ============================================ */
    .ss-mb-0 {
      margin-bottom: 0;
    }
    
    .ss-mt-0 {
      margin-top: 0;
    }
    
    /* Body scroll lock when modal is open */
    body.ss-modal-open {
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div class="ss-container">
    <!-- Header Section -->
    <header class="ss-section ss-header">
      <div class="ss-category-tag">LJUBAVNI ODNOSI</div>
      <h1 class="ss-headline">
        <em>On ne zna da ti se sviđa.</em> Zato ne prilazi. <strong class="u">ALI evo kako ćeš mu reći da priđe bez izgovorene riječi.</strong>
      </h1>
      <div class="ss-byline">
        13. studenog 2025. • <strong>SignaliStrasti tim</strong> | <em>Balkanska studija neverbalne privlačnosti</em>
      </div>
      <blockquote class="ss-lead-quote">
        "Prilaze mi samo oni koje ne bih ni pogledala. A onaj koji mi se sviđa – ništa."
      </blockquote>
    </header>

    <!-- Hero / VSL Section -->
    <section class="ss-section ss-hero">
      <h2 class="ss-hero-title">
        <strong>Danas, čak i kad ga pogledaš — on neće prići, osim ako ne zna da smije.</strong>
      </h2>
      <p class="ss-sub-lead" style="font-size: 18.5px; line-height: 1.9; margin-bottom: var(--ss-spacing-xl);">
        <u>Evo što mu zapravo trebaš "reći" — bez da izgovoriš ijednu riječ.</u>
      </p>
      
      <div class="ss-video-wrapper">
        <div class="ss-video-container" id="ss-wistia-container"></div>
        <div class="ss-video-gate" id="ss-video-gate">
          <img data-asset="vsl-thumbnail" alt="Video thumbnail" class="ss-video-thumbnail" id="ss-video-thumbnail">
          <button class="ss-play-button" id="ss-play-button" aria-label="Play video">
            <svg viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
          <div class="ss-play-text">Klikni da otključaš video</div>
        </div>
      </div>
    </section>

    <!-- Content Sections Placeholder -->
    <section class="ss-section ss-section-bg-white" id="ss-content-sections">
      <!-- Sections will be populated via JS based on content structure -->
    </section>

    <!-- Testimonials Blocks -->
    <section class="ss-section ss-section-bg-ivory" id="ss-testimonials-b1">
      <h2 class="ss-text-center">Dojmovi polaznica - Blok 1</h2>
      <div class="ss-testimonials-grid" id="ss-testimonials-grid-b1"></div>
    </section>

    <section class="ss-section ss-section-bg-white" id="ss-testimonials-b2">
      <h2 class="ss-text-center">Dojmovi polaznica - Blok 2</h2>
      <div class="ss-testimonials-grid" id="ss-testimonials-grid-b2"></div>
    </section>

    <section class="ss-section ss-section-bg-ivory" id="ss-testimonials-b3">
      <h2 class="ss-text-center">Dojmovi polaznica - Blok 3</h2>
      <div class="ss-testimonials-grid" id="ss-testimonials-grid-b3"></div>
    </section>

    <section class="ss-section ss-section-bg-white" id="ss-testimonials-b4">
      <h2 class="ss-text-center">Dojmovi polaznica - Blok 4</h2>
      <div class="ss-testimonials-grid" id="ss-testimonials-grid-b4"></div>
    </section>

    <!-- Final CTA Section -->
    <section class="ss-section">
      <div class="ss-cta-section">
        <h2>Spremna da naučiš ove signale?</h2>
        <p>Pogledaj video i otkrij kako da mu pokažeš interesovanje bez reči.</p>
        <button class="ss-cta-button" data-cta="checkout">Pogledaj Video Sada</button>
      </div>
    </section>
  </div>

  <!-- Lead Capture Modal -->
  <div class="ss-modal-overlay" id="ss-modal-overlay" role="dialog" aria-labelledby="ss-modal-title" aria-modal="true">
    <div class="ss-modal">
      <button class="ss-modal-close" id="ss-modal-close" aria-label="Close modal">
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
      <h2 class="ss-modal-title" id="ss-modal-title">Otključaj Video</h2>
      <p class="ss-modal-subtitle">Unesi svoje podatke da otključaš video i saznaš sve o neverbalnim signalima privlačnosti.</p>
      <form id="ss-lead-form">
        <div class="ss-form-group">
          <label for="ss-first-name" class="ss-form-label">Ime *</label>
          <input 
            type="text" 
            id="ss-first-name" 
            name="firstName" 
            class="ss-form-input" 
            required 
            autocomplete="given-name"
            aria-required="true"
          >
          <div class="ss-form-error" id="ss-first-name-error">Molimo unesite vaše ime.</div>
        </div>
        <div class="ss-form-group">
          <label for="ss-email" class="ss-form-label">Email *</label>
          <input 
            type="email" 
            id="ss-email" 
            name="email" 
            class="ss-form-input" 
            required 
            autocomplete="email"
            aria-required="true"
          >
          <div class="ss-form-error" id="ss-email-error">Molimo unesite validnu email adresu.</div>
        </div>
        <button type="submit" class="ss-form-button" id="ss-submit-button">
          <span id="ss-submit-text">Otključaj Video</span>
          <svg id="ss-submit-spinner" style="display: none;" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/>
            <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"/>
          </svg>
        </button>
      </form>
    </div>
  </div>

  <!-- Wistia Embed Script -->
  <script src="https://fast.wistia.com/assets/external/E-v1.js" async></script>

  <script>
    // ============================================
    // CONFIGURATION
    // ============================================
    const CONFIG = {
      environment: "test",
      route: "/test",
      webhookUrl: "",                 // if empty, simulate success
      wistiaVideoId: "WISTIA_ID_HERE", // I will fill later
      checkoutUrl: ""                 // I will fill later (GHL checkout)
    };

    // ============================================
    // ASSETS MAP - Centralized Image Management
    // ============================================
    const ASSETS = {
      // VSL / Hero
      "vsl-thumbnail": "img/hero-2.png",
      
      // Main Page Sections
      "s-section-2": "img/s-section-2.png",
      "s-section-3": "img/s-section-3.png",
      "s-section-4": "img/s-section-4.gif",
      "s-section-5": "img/s-section-5.png",
      "s-section-6": "img/s-section-6.png",
      "s-section-7": "img/s-section-7.png",
      "s-section-8-1": "img/s-section-8-1.png",
      "s-section-8-2": "img/s-section-8-2.png",
      
      // Steps
      "korak1": "img/korak1.gif",
      "korak2": "img/korak2.gif",
      "korak3": "img/korak3.gif",
      
      // Team / Guarantee
      "tim": "img/tim.png",
      "garancija": "img/garancija.png",
      
      // Portal Icons
      "ikon-1": "img/portals/ikon-1.png",
      "ikon-2": "img/portals/ikon-2.png",
      "ikon-3": "img/portals/ikon-3.png",
      "ikon-4": "img/portals/ikon-4.png",
      "ikon-5": "img/portals/ikon-5.png",
      "ikon-6": "img/portals/ikon-6.png",
      "ikon-7": "img/portals/ikon-7.png",
      
      // Mockups
      "mockup-1": "img/SIGNALI-MOCKUP/Mockup-1.png",
      "mockup-2": "img/SIGNALI-MOCKUP/Mockup-2.png",
      "mockup-3": "img/SIGNALI-MOCKUP/Mockup-3.png",
      "mockup-4": "img/SIGNALI-MOCKUP/Mockup-4.png",
      "mockup-5": "img/SIGNALI-MOCKUP/Mockup-5.png",
      "mockup-6": "img/SIGNALI-MOCKUP/Mockup-6.png",
      "mockup-7": "img/SIGNALI-MOCKUP/Mockup-7.png",
      "full-mockup": "img/SIGNALI-MOCKUP/FullMockUp.png"
    };

    // Generate testimonial asset keys programmatically
    for (let block = 1; block <= 4; block++) {
      for (let slide = 1; slide <= 8; slide++) {
        const key = `ts_b${block}_s${slide}`;
        ASSETS[key] = `img/TESTEMES/TS-B${block}-S${slide}.png`;
      }
    }

    // ============================================
    // TESTIMONIAL BLOCKS DATA
    // ============================================
    const TESTIMONIAL_BLOCKS = {
      B1: Array.from({ length: 8 }, (_, i) => `ts_b1_s${i + 1}`),
      B2: Array.from({ length: 8 }, (_, i) => `ts_b2_s${i + 1}`),
      B3: Array.from({ length: 8 }, (_, i) => `ts_b3_s${i + 1}`),
      B4: Array.from({ length: 8 }, (_, i) => `ts_b4_s${i + 1}`)
    };

    // ============================================
    // STATE MANAGEMENT
    // ============================================
    let wistiaPlayer = null;
    let isVideoUnlocked = false;
    let isFormSubmitting = false;

    // ============================================
    // DOM ELEMENTS
    // ============================================
    const elements = {
      videoGate: document.getElementById('ss-video-gate'),
      playButton: document.getElementById('ss-play-button'),
      modalOverlay: document.getElementById('ss-modal-overlay'),
      modalClose: document.getElementById('ss-modal-close'),
      leadForm: document.getElementById('ss-lead-form'),
      firstNameInput: document.getElementById('ss-first-name'),
      emailInput: document.getElementById('ss-email'),
      submitButton: document.getElementById('ss-submit-button'),
      submitText: document.getElementById('ss-submit-text'),
      submitSpinner: document.getElementById('ss-submit-spinner'),
      firstNameError: document.getElementById('ss-first-name-error'),
      emailError: document.getElementById('ss-email-error'),
      wistiaContainer: document.getElementById('ss-wistia-container')
    };

    // ============================================
    // ASSET LOADING SYSTEM
    // ============================================
    function loadAssets() {
      // Load images with data-asset attribute
      document.querySelectorAll('img[data-asset]').forEach(img => {
        const key = img.getAttribute('data-asset');
        if (ASSETS[key]) {
          img.src = ASSETS[key];
          img.onerror = function() {
            console.warn('Failed to load asset:', ASSETS[key]);
            this.style.display = 'none';
          };
        } else {
          console.warn('Asset key not found:', key);
        }
      });

      // Load background images with data-bg attribute
      document.querySelectorAll('[data-bg]').forEach(el => {
        const key = el.getAttribute('data-bg');
        if (ASSETS[key]) {
          el.style.backgroundImage = `url(${ASSETS[key]})`;
          el.style.backgroundSize = 'cover';
          el.style.backgroundPosition = 'center';
        } else {
          console.warn('Background asset key not found:', key);
        }
      });
    }

    // ============================================
    // TESTIMONIAL RENDERING
    // ============================================
    function renderTestimonials() {
      Object.keys(TESTIMONIAL_BLOCKS).forEach(blockKey => {
        const gridId = `ss-testimonials-grid-${blockKey.toLowerCase()}`;
        const grid = document.getElementById(gridId);
        if (!grid) return;

        const block = TESTIMONIAL_BLOCKS[blockKey];
        grid.innerHTML = '';

        block.forEach(assetKey => {
          const item = document.createElement('div');
          item.className = 'ss-testimonial-item';
          
          const img = document.createElement('img');
          img.setAttribute('data-asset', assetKey);
          img.alt = `Testimonial ${assetKey}`;
          
          item.appendChild(img);
          grid.appendChild(item);
        });
      });

      // Reload assets after rendering
      loadAssets();
    }

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function showError(input, errorElement, message) {
      input.classList.add('error');
      errorElement.textContent = message;
      errorElement.classList.add('show');
    }

    function clearError(input, errorElement) {
      input.classList.remove('error');
      errorElement.classList.remove('show');
    }

    function setLoading(loading) {
      isFormSubmitting = loading;
      elements.submitButton.disabled = loading;
      elements.submitText.style.display = loading ? 'none' : 'inline';
      elements.submitSpinner.style.display = loading ? 'inline-block' : 'none';
    }

    // ============================================
    // MODAL FUNCTIONS
    // ============================================
    function openModal() {
      elements.modalOverlay.classList.add('active');
      document.body.classList.add('ss-modal-open');
      elements.firstNameInput.focus();
    }

    function closeModal() {
      elements.modalOverlay.classList.remove('active');
      document.body.classList.remove('ss-modal-open');
      elements.leadForm.reset();
      clearError(elements.firstNameInput, elements.firstNameError);
      clearError(elements.emailInput, elements.emailError);
    }

    // ============================================
    // VIDEO FUNCTIONS
    // ============================================
    function initializeWistia() {
      if (typeof window.Wistia === 'undefined') {
        console.warn('Wistia script not loaded yet');
        return;
      }

      if (wistiaPlayer) {
        return;
      }

      const videoId = CONFIG.wistiaVideoId;
      if (!videoId || videoId === 'WISTIA_ID_HERE') {
        console.warn('Wistia video ID not configured');
        return;
      }

      wistiaPlayer = window.Wistia.embed(videoId, {
        container: elements.wistiaContainer,
        videoFoam: true,
        autoplay: false,
        silentAutoPlay: false,
        playButton: false,
        controlsVisibleOnLoad: false,
        playerColor: '#C24858'
      });

      wistiaPlayer.bind('ready', function() {
        console.log('Wistia player ready');
      });
    }

    function unlockAndPlayVSL() {
      if (isVideoUnlocked) {
        return;
      }

      isVideoUnlocked = true;
      elements.videoGate.classList.add('hidden');
      
      if (!wistiaPlayer) {
        initializeWistia();
      }

      setTimeout(() => {
        if (wistiaPlayer && typeof wistiaPlayer.play === 'function') {
          wistiaPlayer.play().catch(err => {
            console.warn('Autoplay prevented:', err);
            setTimeout(() => {
              if (wistiaPlayer && typeof wistiaPlayer.play === 'function') {
                wistiaPlayer.play().catch(console.warn);
              }
            }, 500);
          });
        }
      }, 300);
    }

    // ============================================
    // FORM SUBMISSION
    // ============================================
    async function submitLead(firstName, email) {
      let isValid = true;

      if (!firstName || firstName.trim().length === 0) {
        showError(elements.firstNameInput, elements.firstNameError, 'Molimo unesite vaše ime.');
        isValid = false;
      } else {
        clearError(elements.firstNameInput, elements.firstNameError);
      }

      if (!email || !validateEmail(email)) {
        showError(elements.emailInput, elements.emailError, 'Molimo unesite validnu email adresu.');
        isValid = false;
      } else {
        clearError(elements.emailInput, elements.emailError);
      }

      if (!isValid) {
        return false;
      }

      setLoading(true);

      const leadData = {
        firstName: firstName.trim(),
        email: email.trim().toLowerCase(),
        environment: CONFIG.environment,
        route: CONFIG.route,
        timestamp: new Date().toISOString()
      };

      try {
        if (CONFIG.webhookUrl && CONFIG.webhookUrl !== '') {
          const response = await fetch(CONFIG.webhookUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(leadData)
          });

          if (!response.ok) {
            throw new Error(`Webhook error: ${response.status}`);
          }
        } else {
          console.log('Webhook not configured, simulating success:', leadData);
          await new Promise(resolve => setTimeout(resolve, 800));
        }

        closeModal();
        unlockAndPlayVSL();
        return true;
      } catch (error) {
        console.error('Error submitting lead:', error);
        alert('Došlo je do greške. Molimo pokušajte ponovo.');
        setLoading(false);
        return false;
      }
    }

    // ============================================
    // CTA HANDLING
    // ============================================
    function handleCTAClick(e) {
      e.preventDefault();
      const ctaType = e.target.getAttribute('data-cta') || e.target.closest('[data-cta]')?.getAttribute('data-cta');
      
      if (ctaType === 'checkout') {
        if (CONFIG.checkoutUrl && CONFIG.checkoutUrl !== '') {
          window.location.href = CONFIG.checkoutUrl;
        } else {
          console.warn('Checkout URL not configured. Please set CONFIG.checkoutUrl.');
          // Optionally show a small hint to user
          const hint = document.createElement('div');
          hint.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: #ff6b6b; color: white; padding: 12px 16px; border-radius: 8px; font-size: 14px; z-index: 10000; max-width: 300px;';
          hint.textContent = 'Checkout URL nije konfigurisan.';
          document.body.appendChild(hint);
          setTimeout(() => hint.remove(), 3000);
        }
      }
    }

    // ============================================
    // EVENT LISTENERS
    // ============================================
    function setupEventListeners() {
      // Play button click - open modal
      elements.playButton.addEventListener('click', (e) => {
        e.preventDefault();
        if (!isVideoUnlocked) {
          openModal();
        }
      });

      // Video gate click - open modal
      elements.videoGate.addEventListener('click', (e) => {
        if (e.target === elements.videoGate || e.target.classList.contains('ss-video-thumbnail')) {
          openModal();
        }
      });

      // Modal close button
      elements.modalClose.addEventListener('click', closeModal);

      // Modal overlay click (outside modal)
      elements.modalOverlay.addEventListener('click', (e) => {
        if (e.target === elements.modalOverlay) {
          closeModal();
        }
      });

      // ESC key to close modal
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && elements.modalOverlay.classList.contains('active')) {
          closeModal();
        }
      });

      // Form submission
      elements.leadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (isFormSubmitting) {
          return;
        }
        const firstName = elements.firstNameInput.value;
        const email = elements.emailInput.value;
        await submitLead(firstName, email);
      });

      // Real-time validation
      elements.firstNameInput.addEventListener('input', () => {
        if (elements.firstNameInput.value.trim().length > 0) {
          clearError(elements.firstNameInput, elements.firstNameError);
        }
      });

      elements.emailInput.addEventListener('input', () => {
        if (validateEmail(elements.emailInput.value)) {
          clearError(elements.emailInput, elements.emailError);
        }
      });

      // CTA buttons
      document.querySelectorAll('[data-cta]').forEach(btn => {
        btn.addEventListener('click', handleCTAClick);
      });
    }

    // ============================================
    // INITIALIZATION
    // ============================================
    function init() {
      // Check route
      if (CONFIG.environment === 'test' && !window.location.pathname.includes('/test')) {
        console.warn('This page is designed for /test route');
      }

      // Load assets
      loadAssets();

      // Render testimonials
      renderTestimonials();

      // Setup event listeners
      setupEventListeners();

      // Initialize Wistia when script loads
      if (typeof window.Wistia !== 'undefined') {
        initializeWistia();
      } else {
        const checkWistia = setInterval(() => {
          if (typeof window.Wistia !== 'undefined') {
            clearInterval(checkWistia);
            initializeWistia();
          }
        }, 100);

        setTimeout(() => {
          clearInterval(checkWistia);
          if (typeof window.Wistia === 'undefined') {
            console.warn('Wistia script failed to load');
          }
        }, 10000);
      }
    }

    // ============================================
    // START
    // ============================================
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
